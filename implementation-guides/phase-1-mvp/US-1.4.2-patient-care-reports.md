# US-1.4.2: Patient Care Reports

> **Phase:** 1 - Foundation/MVP | **Epic:** 1.4 - Reports & Dashboards | **Estimate:** S (1-3 days)

## Overview

Enable clinicians to generate patient care summary reports for referrals and discharge. Reports are auto-generated from Health Cloud data and exportable as PDF, with PDPA consent-aware data filtering.

**Business Value:** Eliminates manual report compilation (saving 15-20 min per report), ensures completeness of clinical handover documentation, and maintains PDPA compliance by automatically filtering based on patient consent.

## Prerequisites

- US-1.1.1 (Patient Profile Setup) completed
- US-1.2.2 (Care Plan Creation) completed
- US-1.6.1 (Digital Consent Capture) completed or in parallel
- OmniStudio Document Generation or Visualforce PDF capability

## Salesforce Configuration Steps

### Step 1: Design Report Template

**Patient Care Summary Report Structure:**

```
┌─────────────────────────────────────────┐
│          PATIENT CARE SUMMARY            │
│     [Facility Logo]  [Date Generated]    │
├─────────────────────────────────────────┤
│ PATIENT DEMOGRAPHICS                     │
│ Name, DOB, Age, Gender, NRIC (masked)    │
│ Contact, Emergency Contact               │
├─────────────────────────────────────────┤
│ ACTIVE CONDITIONS                        │
│ Condition | ICD-10 | Since | Severity    │
├─────────────────────────────────────────┤
│ CURRENT MEDICATIONS                      │
│ Drug | Dosage | Frequency | Prescriber   │
├─────────────────────────────────────────┤
│ ALLERGIES                                │
│ Allergen | Type | Criticality | Reaction │
├─────────────────────────────────────────┤
│ CARE PLAN SUMMARY                        │
│ Plan Name | Status | Goals (summary)     │
│ Recent Progress Notes                    │
├─────────────────────────────────────────┤
│ RECENT RESULTS (Last 6 months)           │
│ Test | Date | Value | Reference Range    │
├─────────────────────────────────────────┤
│ PDPA NOTICE                              │
│ Consent status, data sharing limitations │
└─────────────────────────────────────────┘
```

### Step 2: Create Data Aggregation Integration Procedure

**Integration Procedure: AggregatePatientData**
- Input: AccountId
- Steps:
  1. Fetch Patient Demographics (DR-PatientDemographics)
  2. Fetch Active Conditions (DR-PatientConditions)
  3. Fetch Current Medications (DR-PatientMedications)
  4. Fetch Allergies (DR-PatientAllergies)
  5. Fetch Active Care Plans with Goals (DR-PatientCarePlans)
  6. Fetch Recent Results (DR-RecentResults — last 6 months)
  7. Fetch PDPA Consent Status (DR-PatientConsent)
  8. Apply PDPA filtering (remove non-consented data)
- Output: Aggregated JSON for document generation

### Step 3: PDPA-Aware Data Filtering

**Consent Check Logic:**
```
IF patient has NOT consented to data sharing for referrals:
  - Exclude sensitive conditions (mental health, HIV, substance abuse)
  - Include PDPA notice: "Some data withheld per patient consent preferences"

IF patient has consented to full clinical sharing:
  - Include all clinical data
  - Include PDPA notice: "Patient has consented to clinical data sharing"

ALWAYS:
  - Mask NRIC (show only S****567A format)
  - Include consent status in report footer
```

### Step 4: Configure PDF Generation

**Option A: OmniStudio Document Generation**
1. Create Document Template in OmniStudio
2. Map data fields from Integration Procedure output
3. Configure PDF styling (headers, tables, colours)
4. Add facility branding (logo, footer)

**Option B: Visualforce PDF (fallback)**
1. Create Visualforce page: `PatientCareSummary`
2. Apex Controller: `PatientCareSummaryController`
3. Set `renderAs="pdf"` on the page
4. Query same data as Integration Procedure

### Step 5: Create Report Generation Action

**Quick Action: Generate_Care_Report**
- Location: Patient Person Account page
- Type: OmniScript or Flow
- Steps:
  1. Select report type (Referral Summary, Discharge Summary, General)
  2. Select date range for results
  3. Preview report on-screen
  4. Actions: Download PDF, Email to Provider, Attach to Referral

### Step 6: Store Generated Reports

**Object: PatientDocument__c**

| Field | API Name | Type |
|---|---|---|
| Patient | `Patient__c` | Lookup(Account) |
| Document Type | `Document_Type__c` | Picklist(Referral Summary, Discharge Summary, General) |
| Generated Date | `Generated_Date__c` | DateTime |
| Generated By | `Generated_By__c` | Lookup(User) |
| Content Version | `ContentVersionId__c` | Lookup(ContentVersion) |
| Linked Referral | `Referral__c` | Lookup(ClinicalServiceRequest) |

## Automation & Flows

| Automation | Type | Description |
|---|---|---|
| AggregatePatientData | Integration Procedure | Gathers all patient data for report |
| PDPA Filter | Apex Class | Applies consent-based data filtering |
| PDF Generator | Document Template / VF | Generates formatted PDF |
| Auto-Attach to Referral | Flow | When report generated for referral, auto-attaches |

## Security & Access

- Only clinicians and care coordinators can generate reports
- Reports respect PDPA consent — sensitive data excluded if not consented
- Generated PDFs stored as ContentVersion with appropriate sharing
- Audit trail: who generated what report, when

## Testing Strategy

**UAT Scenarios:**
1. Generate referral summary — all sections populated from Health Cloud data
2. Download as PDF — formatted correctly with facility branding
3. Generate for patient without referral consent — sensitive data excluded, PDPA notice shown
4. Generate for patient with full consent — all data included
5. Report auto-attached to referral record
6. Verify no manual data entry required

## Deployment Checklist

- [ ] Integration Procedure deployed
- [ ] Document Template / VF page deployed
- [ ] PDPA filtering logic deployed
- [ ] Quick Action added to Patient page
- [ ] PatientDocument__c custom object deployed
- [ ] Auto-attach to referral flow active
- [ ] PDF styling verified (branding, formatting)
- [ ] PDPA notice included in all generated reports

## Acceptance Criteria Verification

| Criteria | How to Verify |
|---|---|
| Report includes demographics, conditions, meds, allergies, care plan, results | Generate report, verify all sections present |
| Exportable as PDF | Download PDF, verify formatting |
| Auto-generated from Health Cloud data | Verify no manual entry in report |
| PDPA compliant (excludes data based on consent) | Generate for non-consented patient, verify exclusions |

## Dependencies

- **Blocked By:** US-1.1.1, US-1.2.2, US-1.6.1 (for PDPA filtering)
- **Blocks:** US-1.3.2 (Referral attaches care summary)
